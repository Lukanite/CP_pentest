# Project 8 - Pentesting Live Targets

Time spent: **3** hours spent in total

> Objective: Identify vulnerabilities in three different versions of the Globitek website: blue, green, and red.

The six possible exploits are:
* Username Enumeration
* Insecure Direct Object Reference (IDOR)
* SQL Injection (SQLi)
* Cross-Site Scripting (XSS)
* Cross-Site Request Forgery (CSRF)
* Session Hijacking/Fixation

Each version of the site has been given two of the six vulnerabilities. (In other words, all six of the exploits should be assignable to one of the sites.)

## All (Bonus! A new, undocumented vuln?)

Reflected XSS?! Yep... More specifically, authenticated reflected XSS. The error message for checking integers for territory positions isn't safe against XSS.

This is especially bad on the Red website, since there is no CSRF protection either, so a malicious auto-submitting form, emailed to someone who's logged in, could result in a pwn.

POC:
```html
<form name="x" action="https://site/red/public/staff/territories/edit.php?id=1" method="post">
<input type="hidden" name='position' value='<script>alert(/XSS/)</script>'>
<input type="hidden" name="name" value="Alabama" type="text">
</form>
<script>document.x.submit();</script>
```

Doing it the manual way GIF (294KB, ~7s):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/bonus.gif" />

Auto-PWN GIF (258KB, ~10s):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/bonus2.gif" />

## Blue

Vulnerability #1: SQL Injection

The "Show" function for listing Salespeople details does not perform sufficient validation on `id` (i.e. check to see if it's an integer), allowing SQL injection to occur.

POC:

Break the page by putting in a single quote for ID, or plug your own search terms into the page:
```
' OR id='2
```

GIF (124KB, ~13s):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/3.gif" />

Vulnerability #2: Session Hijacking/Fixation

This website expires cookies after 1 year, which provides ample opportunity for attackers to hijack an old user session.

GIF (43KB, static):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/6.gif" />

## Green

Vulnerability #1: Username Enumeration

A failed login with a valid username results in this failed message:
```html
<span class="failure">Log in was unsuccessful.</span>
```
However, a failed login with a non-existent username results in this failed message (with a different span class):
```html
<span class="failed">Log in was unsuccessful.</span>
```
Based on these differences, an attacker can determine whether or not a given username exists.

GIF (427KB, ~17s):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/1.gif" />

Vulnerability #2: Stored XSS

The feedback form on this website does not properly strip javascript from both the name and feedback fields, allowing XSS to spring upon an unsuspecting admin.

Example POC:
```html
<a href=a onmouseover='alert("Lucario is better than Mewtwo")'>Super Smash Bros True Facts</a>
```

GIF (265KB, ~9s):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/4.gif" />

## Red

Vulnerability #1: Insecure Direct Object Reference

By changing the `id` GET parameter, you can obtain information about salespeople who are "not public" yet. The other two websites just throw you back to the "Find a Salesperson" page on "hidden" users, which doesn't leak information.

POC:

Try visiting id=10, as shown in the GIF below.

GIF (24KB, static):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/2.gif" />

Vulnerability #2: Cross-Site Request Forgery

All websites actually have a hidden post variable called `csrf_token`, but the Red site doesn't check this; you can change it to anything and it'll accept the update, making it vulnerable to CSRF. (If you're looking for a demo of a stealthy form, check the bonus section near the top of this README.)

GIF (337KB, ~13s):

<img src="https://github.com/Lukanite/CP_pentest/raw/master/5.gif" />

## Notes

Trying to think of enough memes to fill each text box, which I egregiously failed at.

